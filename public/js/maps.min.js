const greenMarker="/img/greenMarker.png",yellowMarker="/img/yellowMarker.png",redMarker="/img/redMarker.png",greyMarker="/img/greyMarker.png",apiUrl="https://8oi9s0nnth.apigw.ntruss.com/corona19-masks/v1/storesByGeo/json";let centerLat=37.394914,centerLng=127.1100797,container=document.getElementById("map"),options={center:new kakao.maps.LatLng(centerLat,centerLng),level:5},map=new kakao.maps.Map(container,options);function setCurrentPosition(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(a){centerLat=a.coords.latitude,centerLng=a.coords.longitude;let b=new kakao.maps.LatLng(centerLat,centerLng),c="?lat="+centerLat+"&lng="+centerLng+"&m=1000";httpGetAsync(apiUrl+c,displayMarker),map.setCenter(b)})}kakao.maps.event.addListener(map,"dragend",function(){let a=map.getCenter();centerLat=a.getLat(),centerLng=a.getLng();let b="?lat="+centerLat+"&lng="+centerLng+"&m=1000";httpGetAsync(apiUrl+b,displayMarker)});function displayMarker(a){let b=a.stores;b.forEach(function(a){let b=getMarker(a.remain_stat),c=new kakao.maps.Size(24,35),d=new kakao.maps.MarkerImage(b,c),e=new kakao.maps.Marker({map:map,position:new kakao.maps.LatLng(a.lat,a.lng),image:d}),f=new kakao.maps.CustomOverlay({position:e.getPosition()}),g=getOverlayContent(a,f);f.setContent(g),kakao.maps.event.addListener(e,"click",function(){f.setMap(map)})})}function getMarker(a){switch(a){case"plenty":return greenMarker;case"some":return yellowMarker;case"few":return redMarker;case"empty":default:return greyMarker;}}function getOverlayContent(a,b){let c=document.createElement("div");c.classList.add("wrap");let d=document.createElement("div");d.classList.add("info");let e=document.createElement("div");e.classList.add("title"),e.appendChild(document.createTextNode(a.name));let f=document.createElement("div");f.classList.add("close"),f.onclick=function(){b.setMap(null)};let g=document.createElement("div");return g.classList.add("body"),g.appendChild(document.createTextNode("\uC785\uACE0 \uC2DC\uAC04 : "+getStockAt(a.stock_at))),c.appendChild(d),d.appendChild(e),d.appendChild(g),e.appendChild(f),c}function getStockAt(a){return null==a||"null"==a||void 0===a?"\uC785\uACE0 \uB300\uAE30":a}function httpGet(a){let b=new XMLHttpRequest;return b.open("GET",a,!1),b.send(),JSON.parse(b.responseText)}function httpGetAsync(a,b){let c=new XMLHttpRequest;c.onreadystatechange=function(){4==c.readyState&&200==c.status&&b(JSON.parse(c.responseText))},c.open("GET",a,!0),c.send()}document.addEventListener("DOMContentLoaded",function(){setCurrentPosition()});