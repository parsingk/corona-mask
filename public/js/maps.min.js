const greenMarker="/img/greenMarker.png",yellowMarker="/img/yellowMarker.png",redMarker="/img/redMarker.png",greyMarker="/img/greyMarker.png",green="lawngreen",yellow="#ffc400",red="red",grey="grey",apiUrl="https://8oi9s0nnth.apigw.ntruss.com/corona19-masks/v1/storesByGeo/json",range="1000";let centerLat=37.394914,centerLng=127.1100797,container=document.getElementById("map"),options={center:new kakao.maps.LatLng(centerLat,centerLng),level:5},map=new kakao.maps.Map(container,options),markers=[];function setCurrentPosition(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(a){centerLat=a.coords.latitude,centerLng=a.coords.longitude;let b=new kakao.maps.LatLng(centerLat,centerLng),c="?lat="+centerLat+"&lng="+centerLng+"&m="+range;httpGetAsync(apiUrl+c,displayMarker),map.setCenter(b)})}kakao.maps.event.addListener(map,"dragend",function(){let a=map.getCenter();centerLat=a.getLat(),centerLng=a.getLng();let b="?lat="+centerLat+"&lng="+centerLng+"&m="+range;httpGetAsync(apiUrl+b,displayMarker)});function isMarkerOnMap(a,b,c=[]){let d=c.find(c=>c.lat==a&&c.lng==b);return void 0===d?parseFloat(b.toFixed(7)):(b+=65e-6,isMarkerOnMap(a,b,c))}function displayMarker(a){let b=a.stores,c=[],d=null,e=null;markers.forEach(function(a){a.setMap(null)}),markers=[],b.forEach(function(a){d=a.lat,e=a.lng,e=isMarkerOnMap(d,e,c);let b=getMarker(a.remain_stat),f=new kakao.maps.Size(24,35),g=new kakao.maps.MarkerImage(b,f),h=new kakao.maps.Marker({map:map,position:new kakao.maps.LatLng(d,e),image:g}),i=new kakao.maps.CustomOverlay({position:h.getPosition()}),j=getOverlayContent(a,i);i.setContent(j),c.push({lat:d,lng:e}),markers.push(h),kakao.maps.event.addListener(h,"click",function(){i.setMap(map)})})}function getColor(a){switch(a){case"plenty":return green;case"some":return yellow;case"few":return red;case"empty":default:return grey;}}function getMarker(a){switch(a){case"plenty":return greenMarker;case"some":return yellowMarker;case"few":return redMarker;case"empty":default:return greyMarker;}}function getOverlayContent(a,b){let c=document.createElement("div");c.classList.add("wrap");let d=document.createElement("div");d.classList.add("info");let e=document.createElement("div"),f=getColor(a.remain_stat);e.classList.add("title"),e.style.backgroundColor=f,e.style.color=f===grey||f===red?"white":"black",e.appendChild(document.createTextNode(a.name));let g=document.createElement("div");g.classList.add("close"),g.onclick=function(){b.setMap(null)};let h=document.createElement("div");return h.classList.add("body"),h.appendChild(document.createTextNode("\uC785\uACE0 \uC2DC\uAC04 : "+getStockAt(a.stock_at))),c.appendChild(d),d.appendChild(e),d.appendChild(h),e.appendChild(g),c}function getStockAt(a){return null==a||"null"==a||void 0===a?"\uC785\uACE0 \uB300\uAE30":a}function httpGet(a){let b=new XMLHttpRequest;return b.open("GET",a,!1),b.send(),JSON.parse(b.responseText)}function httpGetAsync(a,b){let c=new XMLHttpRequest;c.onreadystatechange=function(){4==c.readyState&&200==c.status&&b(JSON.parse(c.responseText))},c.open("GET",a,!0),c.send()}document.addEventListener("DOMContentLoaded",function(){setCurrentPosition()});